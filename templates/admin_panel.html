{% extends "admin_base.html" %}

{% block content %}
<div style="padding: 10px;">
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px;">
        <div style="background: #2c3e50; color: white; padding: 20px; border-radius: 8px; border-left: 5px solid #34495e;">
            <h3 style="margin:0; font-size: 1.8rem;">{{ stats.total }}</h3>
            <p style="margin:0; font-size: 0.8rem; opacity: 0.8;">Total Registrations</p>
        </div>
        <div style="background: #ED1C24; color: white; padding: 20px; border-radius: 8px; border-left: 5px solid #c0392b;">
            <h3 style="margin:0; font-size: 1.8rem;">{{ stats.pending }}</h3>
            <p style="margin:0; font-size: 0.8rem; opacity: 0.8;">Pending Approval</p>
        </div>
        <div style="background: #00B65E; color: white; padding: 20px; border-radius: 8px; border-left: 5px solid #27ae60;">
            <h3 style="margin:0; font-size: 1.8rem;">{{ stats.verified }}</h3>
            <p style="margin:0; font-size: 0.8rem; opacity: 0.8;">Verified/Admit Issued</p>
        </div>
    </div>

    <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
        <form method="GET" action="{{ url_for('admin_dashboard') }}" style="display: flex; flex-wrap: wrap; gap: 10px; align-items: flex-end;">
            <div style="flex: 1; min-width: 200px;">
                <label style="font-size: 0.75rem; font-weight: bold; color: #666;">SEARCH ANY</label>
                <input type="text" name="search" value="{{ request.args.get('search', '') }}" placeholder="Name, Roll, or School" 
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            <div style="width: 150px;">
                <label style="font-size: 0.75rem; font-weight: bold; color: #666;">CENTER</label>
                <select name="center" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="">All Centers</option>
                    <option value="BOG-01" {% if request.args.get('center') == 'BOG-01' %}selected{% endif %}>BOG-01 (Sadar)</option>
                    <option value="BOG-02" {% if request.args.get('center') == 'BOG-02' %}selected{% endif %}>BOG-02 (Sherpur)</option>
                </select>
            </div>
            <button type="submit" style="background: var(--navy); color: white; border: none; padding: 11px 20px; border-radius: 4px; cursor: pointer;">
                <i class="fas fa-filter"></i> Apply
            </button>
            <a href="{{ url_for('admin_dashboard') }}" style="padding: 11px; color: #666; text-decoration: none;">Clear</a>
        </form>
    </div>

    <div style="background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); overflow: hidden;">
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; min-width: 800px;">
                <thead>
                    <tr style="text-align: left; background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                        <th style="padding: 15px;">Roll & Info</th>
                        <th style="padding: 15px;">Institute</th>
                        <th style="padding: 15px;">Center</th>
                        <th style="padding: 15px;">Payment/Status</th>
                        <th style="padding: 15px;">Quick Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for s in students %}
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 15px;">
                            <div style="font-weight: bold;">{{ s.roll_no }}</div>
                            <div style="font-size: 0.85rem; color: #555;">{{ s.name }}</div>
                        </td>
                        <td style="padding: 15px; font-size: 0.85rem;">{{ s.institute_bn }}</td>
                        <td style="padding: 15px;"><span style="background: #e9ecef; padding: 3px 8px; border-radius: 3px; font-size: 0.75rem;">{{ s.center_code }}</span></td>
                        <td style="padding: 15px;">
                            <code style="font-size: 0.75rem; color: #e83e8c;">{{ s.tran_id or 'No ID' }}</code>
                        </td>
                        <td style="padding: 15px;">
                            <select onchange="updateStatus('{{ s.roll_no }}', this.value)" 
                                    style="padding: 6px; border-radius: 4px; font-size: 0.85rem; border: 1px solid {% if s.status == 'Verified' %}#00B65E{% else %}#ED1C24{% endif %};">
                                <option value="Pending" {% if s.status == 'Pending' %}selected{% endif %}>Pending</option>
                                <option value="Verified" {% if s.status == 'Verified' %}selected{% endif %}>Verified</option>
                            </select>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
function updateStatus(roll, newStatus) {
    fetch('/admin/api/update_status', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({roll: roll, status: newStatus})
    })
    .then(response => response.json())
    .then(data => {
        if(data.success) {
            // Optional: Show a tiny toast notification
            location.reload(); // Reload to refresh stats cards
        }
    });
}
</script>
{% endblock %}