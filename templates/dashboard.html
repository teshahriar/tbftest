{% extends "base.html" %}

{% block title %}Student Dashboard | {{ student.name_en }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
    :root {
        --navy: #1B2631;
        --crimson: #922B21;
        --gold: #D4AC0D;
        --bg: #F4F6F7;
        --emerald: #10b981;
    }

    .dashboard-wrapper {
        display: flex;
        justify-content: center;
        padding: 30px 15px;
        background: var(--bg);
        min-height: 85vh;
    }

    .dashboard-card {
        max-width: 850px;
        width: 100%;
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        overflow: hidden;
        border: 1px solid #e2e8f0;
    }

    /* Status Banner */
    .status-banner {
        padding: 12px;
        text-align: center;
        font-size: 0.85rem;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    .status-verified { background: var(--emerald); color: white; }
    .status-pending { background: var(--gold); color: var(--navy); }

    /* Profile Header */
    .profile-section {
        display: flex;
        gap: 30px;
        padding: 40px 30px;
        background: linear-gradient(to right, #ffffff, #f8fafc);
        border-bottom: 2px solid #f1f5f9;
        align-items: center;
    }

    .profile-photo {
        width: 140px;
        height: 140px;
        border-radius: 12px;
        object-fit: cover;
        border: 4px solid white;
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }

    .student-info h1 {
        font-size: 1.8rem;
        color: var(--navy);
        margin: 0 0 10px 0;
    }

    .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px 25px;
        font-size: 0.95rem;
        color: #4a5568;
    }

    .info-item i { color: var(--gold); margin-right: 5px; width: 15px; }

    /* Action Cards */
    .main-actions {
        padding: 30px;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 20px;
    }

    .action-box {
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 16px;
        padding: 25px 20px;
        text-align: center;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .action-box:hover { transform: translateY(-5px); box-shadow: 0 12px 20px rgba(0,0,0,0.05); border-color: var(--gold); }

    .action-box i { font-size: 2.2rem; margin-bottom: 15px; display: block; }
    
    .btn-dash {
        display: inline-block;
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 700;
        font-size: 0.85rem;
        text-transform: uppercase;
        margin-top: 15px;
        transition: 0.3s;
        border: none;
        cursor: pointer;
    }

    .btn-slip { background: #e8f5e9; color: #2e7d32; }
    .btn-slip:hover { background: #2e7d32; color: white; }
    
    .btn-admit { background: #e1f5fe; color: #0277bd; }
    .btn-admit:hover { background: #0277bd; color: white; }
    
    .btn-result { background: var(--emerald); color: white; box-shadow: 0 4px 10px rgba(16, 185, 129, 0.2); }
    .btn-disabled { background: #f1f5f9; color: #94a3b8; cursor: not-allowed; border: 1px solid #e2e8f0; }

    /* Payment Submission Area */
    .payment-area {
        margin: 0 30px 30px;
        padding: 25px;
        background: #fffbeb;
        border: 1px dashed var(--gold);
        border-radius: 12px;
    }

    .tran-form { display: flex; gap: 10px; margin-top: 15px; }
    .tran-input {
        flex: 1; padding: 12px; border: 1px solid #cbd5e0; border-radius: 6px; outline: none;
        font-family: monospace; letter-spacing: 1px;
    }

    @media (max-width: 650px) {
        .profile-section { flex-direction: column; text-align: center; padding: 30px 15px; }
        .info-grid { grid-template-columns: 1fr; }
        .tran-form { flex-direction: column; }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">
    <div class="dashboard-card">
        
        {% if is_verified %}
            <div class="status-banner status-verified"><i class="fas fa-check-circle"></i> Profile Verified</div>
        {% else %}
            <div class="status-banner status-pending"><i class="fas fa-clock"></i> Pending Verification</div>
        {% endif %}

        <div class="profile-section">
            <img src="{{ url_for('static', filename='uploads/' + student.photo) }}" 
                 alt="Profile" class="profile-photo" 
                 onerror="this.src='https://ui-avatars.com/api/?name={{ student.name_en }}&background=1B2631&color=fff'">
            
            <div class="student-info">
                <h1>{{ student.name_en }}</h1>
                <div class="info-grid">
                    <div class="info-item"><i class="fas fa-id-badge"></i> <strong>Roll:</strong> {{ student.roll_no }}</div>
                    <div class="info-item"><i class="fas fa-graduation-cap"></i> <strong>Class:</strong> {{ student.student_class }}</div>
                    <div class="info-item"><i class="fas fa-hashtag"></i> <strong>Reg:</strong> {{ student.reg_no }}</div>
                    <div class="info-item"><i class="fas fa-map-marker-alt"></i> <strong>Center:</strong> {{ student.center_code }}</div>
                </div>
            </div>
        </div>

        <div class="main-actions">
            
            <div class="action-box">
                <i class="fas fa-file-invoice-dollar" style="color: #2e7d32;"></i>
                <h3 style="margin: 0;">Payment Slip</h3>
                <p style="font-size: 0.75rem; color: #64748b;">Registration Invoice</p>
                {% if student.tran_id %}
                    <a href="{{ url_for('download_slip') }}" target="_blank" class="btn-dash btn-slip">
                        <i class="fas fa-download"></i> Download
                    </a>
                {% else %}
                    <button class="btn-dash btn-disabled">Pending ID</button>
                {% endif %}
            </div>

            <div class="action-box">
                <i class="fas fa-address-card" style="color: #0277bd;"></i>
                <h3 style="margin: 0;">Admit Card</h3>
                <p style="font-size: 0.75rem; color: #64748b;">Exam Hall Ticket</p>
                {% if is_verified %}
                    <a href="{{ url_for('download_admit') }}" target="_blank" class="btn-dash btn-admit">
                        <i class="fas fa-print"></i> Print Admit
                    </a>
                {% else %}
                    <button class="btn-dash btn-disabled">Locked</button>
                {% endif %}
            </div>

            <div class="action-box">
                <i class="fas fa-poll-h" style="color: var(--crimson);"></i>
                <h3 style="margin: 0;">Exam Result</h3>
                <p style="font-size: 0.75rem; color: #64748b;">Merit & Grade</p>
                
                {% if is_published %}
                    {% if is_verified and student.marks %}
                        <a href="{{ url_for('view_result') }}" class="btn-dash btn-result">
                            <i class="fas fa-star"></i> View Result
                        </a>
                    {% else %}
                        <button class="btn-dash btn-disabled" title="Verification required">
                            Processing
                        </button>
                    {% endif %}
                {% else %}
                    <button class="btn-dash btn-disabled">Not Published</button>
                    <p style="font-size: 10px; color: #e11d48; margin-top: 8px; font-weight: bold;">
                        <i class="fas fa-bullhorn"></i> Coming Soon!
                    </p>
                {% endif %}
            </div>

        </div>

        {% if not is_verified %}
        <div class="payment-area">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                <i class="fas fa-shield-alt" style="color: var(--gold); font-size: 1.2rem;"></i>
                <h3 style="margin: 0; font-size: 1.1rem; color: var(--navy);">Verify Transaction</h3>
            </div>
            <p style="font-size: 0.85rem; color: #718096;">
                Please submit the <strong>SSLCommerz Transaction ID</strong> received via SMS/Email to unlock your Admit Card.
            </p>
            
            <form method="POST" class="tran-form">
                <input type="text" name="tran_id" class="tran-input" 
                       placeholder="e.g. SSL65AF89..." 
                       value="{{ student.tran_id or '' }}" required>
                <button type="submit" class="btn-dash" style="background: var(--navy); color: white; margin-top: 0; width: auto; padding: 0 30px;">
                    Submit ID
                </button>
            </form>

            {% if student.tran_id %}
                <div style="margin-top: 15px; padding: 10px; background: #fff; border-radius: 6px; font-size: 0.8rem; color: #92400e; border: 1px solid #fde68a;">
                    <i class="fas fa-info-circle"></i> <strong>Update:</strong> ID <code>{{ student.tran_id }}</code> is under review. You will be notified once verified.
                </div>
            {% endif %}
        </div>
        {% endif %}

    </div>
</div>
{% endblock %}