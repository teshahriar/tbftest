{% extends "base.html" %}
{% block content %}
<style>
    :root { --navy: #1B2631; --paper-white: #FFFFFF; --accent-crimson: #922B21; --input-border: #ABB2B9; }
    body { background-color: #F4F6F7; font-family: 'Segoe UI', sans-serif; }
    
    .form-container { max-width: 1000px; margin: 20px auto; background: white; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); overflow: hidden; }
    .form-banner { background: var(--navy); color: white; padding: 25px; text-align: center; border-bottom: 4px solid var(--accent-crimson); }
    .form-content { padding: 30px; }

    .grid-row { 
        display: grid; 
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
        gap: 20px; 
        margin-bottom: 15px; 
        align-items: start;
    }

    .field-box { display: flex; border: 1px solid var(--input-border); min-height: 45px; background: #fff; transition: 0.3s; }
    .field-box:focus-within { border-color: var(--accent-crimson); box-shadow: 0 0 5px rgba(146, 43, 33, 0.2); }
    
    .field-box label { 
        background: var(--navy); color: #fff; padding: 0 12px; min-width: 135px; 
        display: flex; align-items: center; font-size: 11px; font-weight: 600; text-transform: uppercase; 
    }
    .field-box input, .field-box select { flex: 1; border: none; padding: 10px; outline: none; font-size: 14px; width: 100%; }

    .section-title { background: #EBEDEF; padding: 12px; font-weight: 700; border-left: 5px solid var(--accent-crimson); margin: 30px 0 15px; display: flex; justify-content: space-between; align-items: center; }
    
    #groupSection { display: none; }
    .btn-submit { background: var(--accent-crimson); color: white; padding: 15px 50px; border: none; font-weight: 700; cursor: pointer; width: 100%; text-transform: uppercase; margin-top: 30px; transition: 0.3s; }
    .btn-submit:hover { background: var(--navy); transform: translateY(-2px); }

    .checkbox-label { font-size: 12px; cursor: pointer; display: flex; align-items: center; gap: 5px; color: var(--navy); }

    @media (max-width: 600px) {
        .field-box { flex-direction: column; }
        .field-box label { min-width: 100%; padding: 8px 12px; }
    }
</style>

<div class="form-container">
    <div class="form-banner">
        <h2>Scholarship Application Form - 2026</h2>
        <p>The Brilliants Foundation, Bogura</p>
    </div>

    <form action="{{ url_for('apply') }}" method="POST" enctype="multipart/form-data" class="form-content" id="scholarshipForm">
        
        <div class="grid-row">
            <div class="field-box">
                <label>Academic Class</label>
                <select name="student_class" id="classSelector" onchange="toggleGroup()" required>
                    <option value="" disabled selected>Select Class</option>
                    {% for n in range(3, 11) %}
                        <option value="{{ n }}">Class {{ n }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="field-box" id="groupSection">
                <label>Group/Category</label>
                <select name="category" id="categoryInput">
                    <option value="General">General</option>
                    <option value="Science">Science</option>
                    <option value="Humanities">Humanities</option>
                    <option value="Commerce">Commerce</option>
                </select>
            </div>

            <div class="field-box">
                <label>Exam Center</label>
                <select name="center_code" required>
                    <option value="" disabled selected>Select Center</option>
                    {% for c in centers %}
                        <option value="{{ c.center_code }}">{{ c.center_code }} - {{ c.center_name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="section-title">Personal Information</div>
        <div class="grid-row">
            <div class="field-box"><label>Name (English)</label><input type="text" name="name_en" required></div>
            <div class="field-box"><label>নাম (বাংলা)</label><input type="text" name="name_bn" required></div>
        </div>

        <div class="grid-row">
            <div class="field-box"><label>Father's Name (EN)</label><input type="text" name="father_en" required></div>
            <div class="field-box"><label>পিতার নাম (বাংলা)</label><input type="text" name="father_bn" required></div>
        </div>

        <div class="grid-row">
            <div class="field-box"><label>Mother's Name (EN)</label><input type="text" name="mother_en" required></div>
            <div class="field-box"><label>মাতার নাম (বাংলা)</label><input type="text" name="mother_bn" required></div>
        </div>

        <div class="grid-row">
            <div class="field-box"><label>Mobile No</label><input type="tel" name="mobile" pattern="[0-9]{11}" placeholder="017XXXXXXXX" required></div>
            <div class="field-box"><label>Date of Birth</label><input type="date" name="dob" required></div>
        </div>

        <div class="section-title">Institutional Information</div>
        <div class="grid-row">
            <div class="field-box">
                <label>Institution (EN)</label>
                <select name="institute_en" required>
                    <option value="" disabled selected>Select Your School/Madrasah</option>
                    {% for inst in institutes %}
                        <option value="{{ inst.name }}">{{ inst.name }}</option>
                    {% endfor %}
                    <option value="Other">Other (Not in list)</option>
                </select>
            </div>
            <div class="field-box">
                <label>প্রতিষ্ঠান (বাংলা)</label>
                <input type="text" name="institute_bn" placeholder="প্রতিষ্ঠানের নাম বাংলায়" required>
            </div>
        </div>

        <div class="grid-row">
            <div>
                <div class="section-title">Present Address</div>
                <div class="field-box"><label>Village</label><input type="text" name="pre_v" id="pre_v" required></div>
                <div class="field-box"><label>Upazila</label><input type="text" name="pre_t" id="pre_t" required></div>
                <div class="field-box"><label>District</label><input type="text" name="pre_d" id="pre_d" required></div>
            </div>
            <div>
                <div class="section-title">
                    Permanent Address
                    <label class="checkbox-label">
                        <input type="checkbox" id="same_as_present" onclick="copyAddress()"> Same as Present
                    </label>
                </div>
                <div class="field-box"><label>Village</label><input type="text" name="per_v" id="per_v" required></div>
                <div class="field-box"><label>Upazila</label><input type="text" name="per_t" id="per_t" required></div>
                <div class="field-box"><label>District</label><input type="text" name="per_d" id="per_d" required></div>
            </div>
        </div>

        <div class="section-title">Security & Media</div>
        <div class="grid-row">
            <div class="field-box"><label>Password</label><input type="password" name="password" minlength="6" required></div>
            <div class="field-box"><label>Confirm</label><input type="password" name="confirm_password" minlength="6" required></div>
        </div>

        <div class="grid-row" style="margin-top: 20px;">
            <div style="text-align: center; border: 2px dashed #ccc; padding: 15px; background: #fafafa;">
                <label style="font-weight: bold; font-size: 12px; display: block; margin-bottom: 5px;">PHOTO (Max 200KB)</label>
                <input type="file" name="photo" id="photoInput" accept="image/*" required>
            </div>
            <div style="text-align: center; border: 2px dashed #ccc; padding: 15px; background: #fafafa;">
                <label style="font-weight: bold; font-size: 12px; display: block; margin-bottom: 5px;">SIGNATURE (Max 100KB)</label>
                <input type="file" name="signature" id="sigInput" accept="image/*" required>
            </div>
        </div>

        <button type="submit" class="btn-submit">Submit Application</button>
    </form>
</div>

<script>
    function toggleGroup() {
        const classSelect = document.getElementById('classSelector');
        const groupSection = document.getElementById('groupSection');
        // Class 9 এবং 10 এর জন্য গ্রুপ দেখাবে
        if (classSelect.value === "9" || classSelect.value === "10") {
            groupSection.style.display = "flex";
        } else {
            groupSection.style.display = "none";
        }
    }

    function copyAddress() {
        const checkBox = document.getElementById('same_as_present');
        const fields = ['v', 't', 'd'];
        
        fields.forEach(f => {
            if (checkBox.checked) {
                document.getElementById('per_' + f).value = document.getElementById('pre_' + f).value;
                document.getElementById('per_' + f).readOnly = true;
            } else {
                document.getElementById('per_' + f).value = "";
                document.getElementById('per_' + f).readOnly = false;
            }
        });
    }

    // ফর্ম সাবমিশন ভ্যালিডেশন
    document.getElementById('scholarshipForm').onsubmit = function(e) {
        const pass = document.getElementsByName('password')[0].value;
        const confirm = document.getElementsByName('confirm_password')[0].value;
        const photo = document.getElementById('photoInput').files[0];
        const sig = document.getElementById('sigInput').files[0];

        // ১. পাসওয়ার্ড ম্যাচিং চেক
        if (pass !== confirm) {
            alert("Error: পাসওয়ার্ড দুটির মিল নেই!");
            e.preventDefault();
            return false;
        }

        // ২. ফটো সাইজ চেক (Max 200KB)
        if (photo && photo.size > 200 * 1024) {
            alert("Error: স্টুডেন্টের ছবি ২০০ কেবির বেশি বড় হওয়া যাবে না!");
            e.preventDefault();
            return false;
        }

        // ৩. সিগনেচার সাইজ চেক (Max 100KB)
        if (sig && sig.size > 100 * 1024) {
            alert("Error: সিগনেচারের সাইজ ১০০ কেবির বেশি বড় হওয়া যাবে না!");
            e.preventDefault();
            return false;
        }

        return true;
    };
</script>
{% endblock %}