{% extends "base.html" %}

{% block title %}Student Dashboard | {{ student.name_en }}{% endblock %}

{% block extra_css %}
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&family=Hind+Siliguri:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
    :root {
        --navy: #0F172A;
        --gold: #C5A059;
        --emerald: #10B981;
        --rose: #F43F5E;
        --slate: #64748B;
        --bg-soft: #F8FAFC;
    }

    body { font-family: 'Outfit', 'Hind Siliguri', sans-serif; background-color: var(--bg-soft); }

    .dashboard-wrapper { padding: 40px 15px; min-height: 90vh; }
    
    .dashboard-card {
        max-width: 900px;
        margin: 0 auto;
        background: white;
        border-radius: 24px;
        box-shadow: 0 20px 50px rgba(0,0,0,0.05);
        overflow: hidden;
        border: 1px solid #E2E8F0;
    }

    /* Top Banner */
    .status-banner {
        padding: 14px;
        text-align: center;
        font-size: 0.8rem;
        font-weight: 800;
        letter-spacing: 1.5px;
        text-transform: uppercase;
    }
    .status-verified { background: #DCFCE7; color: #166534; }
    .status-pending { background: #FEF3C7; color: #92400E; }

    /* Profile Header */
    .profile-header {
        display: flex;
        flex-direction: row;
        gap: 30px;
        padding: 40px;
        background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 100%);
        align-items: center;
        border-bottom: 1px solid #F1F5F9;
    }

    .photo-container { position: relative; }
    .profile-photo {
        width: 140px;
        height: 140px;
        border-radius: 20px;
        object-fit: cover;
        border: 5px solid white;
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }

    .student-meta h1 { font-size: 2rem; color: var(--navy); margin-bottom: 10px; font-weight: 800; }
    
    .info-badges { display: flex; flex-wrap: wrap; gap: 10px; }
    .badge-item {
        background: white;
        padding: 6px 12px;
        border-radius: 8px;
        font-size: 0.85rem;
        color: var(--slate);
        border: 1px solid #E2E8F0;
        display: flex;
        align-items: center;
        gap: 6px;
    }
    .badge-item strong { color: var(--navy); }

    /* Grid Actions */
    .action-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 20px;
        padding: 40px;
    }

    .action-card {
        padding: 30px 20px;
        border-radius: 20px;
        background: white;
        border: 1px solid #F1F5F9;
        text-align: center;
        transition: 0.3s ease;
        position: relative;
    }
    .action-card:hover { transform: translateY(-5px); border-color: var(--gold); box-shadow: 0 15px 30px rgba(0,0,0,0.05); }

    .icon-circle {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        font-size: 1.5rem;
    }

    .btn-action {
        display: block;
        width: 100%;
        margin-top: 20px;
        padding: 12px;
        border-radius: 10px;
        text-decoration: none;
        font-weight: 700;
        font-size: 0.9rem;
        transition: 0.3s;
        border: none;
    }

    .btn-download { background: var(--navy); color: white; }
    .btn-download:hover { background: #1e293b; }
    
    .btn-locked { background: #F1F5F9; color: #94A3B8; cursor: not-allowed; }

    /* Payment Notice */
    .payment-notice {
        margin: 0 40px 40px;
        padding: 25px;
        background: #FFFBEB;
        border: 1px dashed #F59E0B;
        border-radius: 16px;
    }

    .input-group { display: flex; gap: 10px; margin-top: 15px; }
    .input-group input {
        flex: 1; padding: 12px 15px; border-radius: 8px; border: 1px solid #CBD5E0;
        font-family: monospace; font-size: 1rem;
    }
    .btn-submit { background: var(--gold); color: white; padding: 0 25px; border-radius: 8px; font-weight: 700; cursor: pointer; border: none; }

    /* Responsive */
    @media (max-width: 768px) {
        .profile-header { flex-direction: column; text-align: center; padding: 30px 20px; }
        .action-grid { padding: 20px; }
        .payment-notice { margin: 0 20px 20px; }
        .input-group { flex-direction: column; }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">
    <div class="dashboard-card">
        
        {% if student.verification %}
            <div class="status-banner status-verified"><i class="fas fa-check-circle"></i> Account Verified</div>
        {% else %}
            <div class="status-banner status-pending"><i class="fas fa-clock"></i> Pending Verification</div>
        {% endif %}

        <div class="profile-header">
            <div class="photo-container">
                <img src="{{ student.photo_url }}"
                     alt="Profile" class="profile-photo"
                     onerror="this.src='https://ui-avatars.com/api/?name={{ student.name_en }}&background=0F172A&color=fff&size=128'">
            </div>
            <div class="student-meta">
                <h1>{{ student.name_en }}</h1>
                <div class="info-badges">
                    <div class="badge-item"><i class="fas fa-fingerprint"></i> Serial: <strong>{{ student.roll_no }}</strong></div>
                    <div class="badge-item"><i class="fas fa-graduation-cap"></i> Class: <strong>{{ student.student_class }}</strong></div>
                    <div class="badge-item"><i class="fas fa-building"></i> Center: <strong>{{ student.center_code }}</strong></div>
                </div>
            </div>
        </div>

        <div class="action-grid">
            
            <div class="action-card">
                <div class="icon-circle" style="background: #ECFDF5; color: #10B981;"><i class="fas fa-file-invoice"></i></div>
                <h3 style="margin-bottom: 5px;">Payment Slip</h3>
                <p style="font-size: 0.8rem; color: var(--slate);">Application Proof</p>
                {% if student.tran_id %}
                    <a href="{{ url_for('download_slip') }}" target="_blank" class="btn-action btn-download">
                        <i class="fas fa-cloud-download-alt"></i> Download Slip
                    </a>
                {% else %}
                    <button class="btn-action btn-locked">ID Needed</button>
                {% endif %}
            </div>

            <div class="action-card">
                <div class="icon-circle" style="background: #EFF6FF; color: #3B82F6;"><i class="fas fa-address-card"></i></div>
                <h3 style="margin-bottom: 5px;">Admit Card</h3>
                <p style="font-size: 0.8rem; color: var(--slate);">Hall Ticket 2026</p>
                
                {% if student.verification and student.admit_approved %}
                    <a href="{{ url_for('download_admit') }}" target="_blank" class="btn-action btn-download" style="background: var(--gold);">
                        <i class="fas fa-print"></i> Print Admit
                    </a>
                {% else %}
                    <button class="btn-action btn-locked">
                        <i class="fas fa-lock"></i> Locked
                    </button>
                    {% if student.verification and not student.admit_approved %}
                        <p style="font-size: 10px; color: var(--rose); margin-top: 8px; font-weight: 700;">Admin Approval Required</p>
                    {% endif %}
                {% endif %}
            </div>

            <div class="action-card">
                <div class="icon-circle" style="background: #FFF1F2; color: #F43F5E;"><i class="fas fa-award"></i></div>
                <h3 style="margin-bottom: 5px;">Exam Result</h3>
                <p style="font-size: 0.8rem; color: var(--slate);">Merit List Status</p>
                
                {% if is_published and student.verification %}
                    <a href="{{ url_for('view_result') }}" class="btn-action btn-download" style="background: var(--emerald);">
                        <i class="fas fa-eye"></i> View Result
                    </a>
                {% else %}
                    <button class="btn-action btn-locked">Not Published</button>
                {% endif %}
            </div>

        </div>

        {% if not student.verification %}
        <div class="payment-notice">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                <i class="fas fa-exclamation-triangle" style="color: #F59E0B;"></i>
                <h3 style="margin: 0; font-size: 1.1rem; color: var(--navy);">Verification Action Required</h3>
            </div>
            <p style="font-size: 0.85rem; color: #78350F; line-height: 1.5;">
                আপনার রেজিস্ট্রেশন সম্পন্ন করতে <strong>SSLCommerz</strong> থেকে প্রাপ্ত Transaction ID টি নিচে প্রদান করুন। অ্যাডমিন ভেরিফাই করার পর আপনার এডমিট কার্ড আনলক হবে।
            </p>
            
            <form method="POST" class="input-group">
                <input type="text" name="tran_id" placeholder="Transaction ID (e.g. SSL65A...)" 
                       value="{{ student.tran_id or '' }}" required>
                <button type="submit" class="btn-submit">Submit ID</button>
            </form>
            
            {% if student.tran_id %}
                <div style="margin-top: 15px; font-size: 0.8rem; color: #B45309; font-weight: 600;">
                    <i class="fas fa-history"></i> Status: ID <code>{{ student.tran_id }}</code> is being reviewed.
                </div>
            {% endif %}
        </div>
        {% endif %}

    </div>
</div>
{% endblock %}