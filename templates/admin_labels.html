{% extends "admin_base.html" %}

{% block content %}
<style>
    :root {
        --navy-dark: #0f172a;
        --accent-blue: #3b82f6;
        --border-soft: #e2e8f0;
        --text-muted: #64748b;
    }

    .dashboard-bg { background: #f1f5f9; min-height: 100vh; padding: 30px 20px; }

    /* --- Filter Bar Style --- */
    .filter-container-premium {
        background: white; border-radius: 16px; padding: 25px;
        margin-bottom: 30px; border: 1px solid var(--border-soft);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
    }

    .filter-grid {
        display: grid; grid-template-columns: 1.5fr 1.5fr 1fr 0.8fr;
        gap: 15px; align-items: flex-end;
    }

    .input-box label { 
        font-size: 11px; font-weight: 800; color: var(--navy-dark); 
        text-transform: uppercase; margin-bottom: 8px; display: block;
    }

    .styled-select, .styled-input {
        width: 100%; padding: 12px; border-radius: 10px;
        border: 1.5px solid var(--border-soft); font-weight: 600; outline: none;
    }

    .btn-filter { background: var(--navy-dark); color: white; border: none; padding: 13px; border-radius: 10px; font-weight: 700; cursor: pointer; width: 100%; }
    .btn-print { background: var(--accent-blue); color: white; border: none; padding: 13px; border-radius: 10px; font-weight: 700; cursor: pointer; width: 100%; }

    /* --- Grid Layout: 10 Cards Per Page --- */
    .label-grid {
        display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;
    }

    /* --- Smart Card Design --- */
    .smart-card {
        background: white; border-radius: 12px; border: 1px solid var(--border-soft);
        display: flex; height: 185px; overflow: hidden; position: relative;
    }

    .grade-ribbon {
        width: 38px; display: flex; align-items: center; justify-content: center;
        writing-mode: vertical-rl; transform: rotate(180deg);
        color: white; font-size: 10px; font-weight: 800; letter-spacing: 1.5px;
    }
    
    /* Grade Specific Colors */
    .ribbon-talentpool { background: #d97706; } /* Gold */
    .ribbon-general { background: #2563eb; }    /* Blue */
    .ribbon-suveccha { background: #059669; }   /* Green */

    .card-body-main { flex: 1; padding: 15px; display: flex; flex-direction: column; }

    .card-brand-header {
        display: flex; align-items: center; justify-content: space-between;
        margin-bottom: 10px; border-bottom: 1px solid #f1f5f9; padding-bottom: 5px;
    }
    .card-brand-header img { height: 32px; }
    .card-brand-header span { font-size: 9px; font-weight: 800; color: var(--navy-dark); text-align: right; }

    .student-core-flex { display: flex; gap: 15px; flex: 1; }
    .img-frame { flex: 0 0 90px; height: 110px; border-radius: 8px; border: 1px solid #f1f5f9; overflow: hidden; }
    .img-frame img { width: 100%; height: 100%; object-fit: cover; }

    .name-heading { font-size: 17px; font-weight: 900; color: #1e293b; margin-bottom: 8px; }
    .data-grid-small { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .data-point label { font-size: 8px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; }
    .data-point span { font-size: 12px; font-weight: 700; color: var(--navy-dark); }

    .inst-footer {
        margin-top: auto; font-size: 10px; font-weight: 600; color: var(--text-muted);
        background: #f8fafc; padding: 5px 10px; border-radius: 6px;
    }

    @media print {
        .no-print { display: none !important; }
        body { background: white; margin: 0; padding: 0; }
        .label-grid { padding: 8mm; gap: 8px; }
        .smart-card { border: 1.5px solid #000; break-inside: avoid; border-radius: 0; }
        .page-break { page-break-after: always; }
    }
</style>

<div class="dashboard-bg">
    <div class="filter-container-premium no-print">
        <form method="GET" class="filter-grid">
            <div class="input-box">
                <label>Center Name</label>
                <select name="center" class="styled-select">
                    <option value="">All Exam Centers</option>
                    {% for c in all_centers %}<option value="{{c}}" {{ 'selected' if request.args.get('center') == c }}>{{c}}</option>{% endfor %}
                </select>
            </div>
            <div class="input-box">
                <label>School Name Search</label>
                <input type="text" name="school" class="styled-input" placeholder="Enter School Name..." value="{{ request.args.get('school', '') }}">
            </div>
            <div class="input-box">
                <label>Roll Number</label>
                <input type="text" name="roll" class="styled-input" placeholder="Roll..." value="{{ request.args.get('roll', '') }}">
            </div>
            <div class="btn-action-group">
                <button type="submit" class="btn-filter">Filter</button>
                <button type="button" onclick="window.print()" class="btn-print">Print</button>
            </div>
        </form>
    </div>

    <div class="label-grid">
        {% set label_count = namespace(value=0) %}
        {% for s in students %}
            {% set raw_grade = s.get('scholarship_grade', '')|upper %}
            
            {# লজিক: শুধুমাত্র Talentpool, General অথবা Suveccha থাকলে কার্ড তৈরি হবে #}
            {% if 'TALENTPOOL' in raw_grade or 'GENERAL' in raw_grade or 'SUVECCHA' in raw_grade %}
                
                {% set label_count.value = label_count.value + 1 %}
                <div class="smart-card">
                    <div class="grade-ribbon 
                        {% if 'TALENTPOOL' in raw_grade %}ribbon-talentpool
                        {% elif 'GENERAL' in raw_grade %}ribbon-general
                        {% elif 'SUVECCHA' in raw_grade %}ribbon-suveccha
                        {% endif %}">
                        {{ raw_grade }}
                    </div>

                    <div class="card-body-main">
                        <div class="card-brand-header">
                            <img src="https://i.postimg.cc/SsLDX6WZ/Screenshot-2026-01-20-020601-removebg-preview.png">
                            <span>THE BRILLIANTS FOUNDATION<br>SESSION 2026</span>
                        </div>

                        <div class="student-core-flex">
                            <div class="img-frame">
                                <img src="{{ url_for('static', filename='uploads/' + (s.get('photo') or 'default.png')) }}">
                            </div>
                            <div class="student-data">
                                <div class="name-heading">{{ (s.get('name_bn') or s.get('name_en', 'N/A'))|upper }}</div>
                                <div class="data-grid-small">
                                    <div class="data-point">
                                        <label>Class</label>
                                        <span>{{ s.get('student_class', 'N/A') }}</span>
                                    </div>
                                    <div class="data-point">
                                        <label>Roll No</label>
                                        <span>#{{ s.get('roll_no', 'N/A') }}</span>
                                    </div>
                                    <div class="data-point">
                                        <label>Center Code</label>
                                        <span>{{ s.get('center_code', 'N/A') }}</span>
                                    </div>
                                </div>
                                <div class="inst-footer">
                                    {% set inst = s.get('institute_en') or 'N/A' %}
                                    {{ inst[:35] }}{{ '...' if inst|length > 35 }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                {# ১০টি কার্ড পর পর পেজ ব্রেক #}
                {% if label_count.value % 10 == 0 %}
                    </div><div class="page-break"></div><div class="label-grid">
                {% endif %}

            {% endif %}
        {% endfor %}
    </div>
</div>
{% endblock %}